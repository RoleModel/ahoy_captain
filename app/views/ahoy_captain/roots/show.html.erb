<main class='' data-controller="application"  data-action="combobox:init@window->application#comboboxInit">
  <%= render AhoyCaptain::StickyNavComponent.new do |nav| %>
    <% nav.with_realtime_update do %>
      <%= turbo_frame_tag :realtime, src: realtime_path, data: { controller:  "realtime", "realtime-interval-value" => AhoyCaptain.config.realtime_interval.to_i }, loading: :lazy %>
    <% end %>
  <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-4 min-h-screen pb-4 max-w-6xl mx-auto">
    <%= render AhoyCaptain::TileComponent.new(wide: true, classes: "p-4 m-2") do |component| %>
      <% component.with_statistic_display do %>
        <%= turbo_frame_tag :stats, src: stats_path(search_params), loading: :lazy %>

        <%= turbo_frame_tag :chart, src: stats_unique_visitors_path(search_params) do %>
        <% end %>
      <% end %>

    <% end %>

    <%= render AhoyCaptain::TileComponent.new(title: 'Top Sources') do |component| %>
      <% component.with_display_links do %>
        <div data-controller="active-links">
          <div class="flex text-xs font-medium text-gray-400 space-x-2">
            <div class="relative inline-block text-left" data-controller="active-links">
              <a href="<%= sources_path(search_params) %>" data-turbo-frame="sources" class="inline-block h-5 font-semibold" data-active-links-target="link">All</a>
              <%= render AhoyCaptain::DropdownLinkComponent.new(title: "Campaign") do |dropdown| %>
                <% %w{utm_source utm_medium utm_term utm_content utm_campaign}.each do |source| %>
                  <% dropdown.with_option do %>
                    <a href="<%= public_send("campaign_#{source}_path".to_sym, **search_params) %>" class=""
                       data-turbo-frame="sources"
                       class="text-sm"
                       data-active-links-target="link">
                      <%= source.titleize.gsub("Utm", "UTM") %>
                    </a>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>


        </div>
      <% end %>
      <% component.with_statistic_display do %>
        <%= turbo_frame_tag :sources, src: sources_path(search_params), loading: :lazy %>
      <% end %>
      <% component.with_details_cta do %>
        <button data-action="click->details-modal#openModal" data-controller="details-modal" data-details-modal-target-value="#sources" class="link no-underline ">Details</button>
      <% end %>
    <% end %>

    <%= render AhoyCaptain::TileComponent.new(title: 'Top Pages') do |component| %>
      <% component.with_display_links do %>
        <div class="flex text-xs font-medium text-gray-400 space-x-2">
          <div class="relative inline-block text-left" data-controller="active-links"><div>
            <a href="<%= top_pages_path(search_params) %>"
               data-turbo-frame="pages"
               class="inline-block h-5 font-semibold"
               data-active-links-target="link"
               data-action="click->tile#setTitle">Top Pages</a>
            <a href="<%= entry_pages_path(search_params) %>" data-turbo-frame="pages" class="inline-block h-5 font-semibold" data-active-links-target="link" data-action="click->tile#setTitle">Entry Pages</a>
            <a href="<%= exit_pages_path(search_params) %>" data-turbo-frame="pages" class="inline-block h-5 font-semibold" data-active-links-target="link" data-action="click->tile#setTitle">Exit Pages</a>
          </div>
          </div>
        </div>

      <% end %>
      <% component.with_statistic_display do %>
        <%= turbo_frame_tag :pages, src: top_pages_path(search_params), loading: :lazy %>
      <% end %>
      <% component.with_details_cta do %>
        <button data-action="click->details-modal#openModal" data-controller="details-modal"  data-details-modal-target-value="#pages" class="link no-underline ">Details</button>
      <% end %>
    <% end %>

    <%= render AhoyCaptain::TileComponent.new(title: 'Map') do |component| %>
      <% component.with_display_links do %>
        <div class="flex text-xs font-medium text-gray-400 space-x-2">
          <div class="relative inline-block text-left" data-controller="active-links">
            <a href="<%= locations_map_path(search_params) %>" data-turbo-frame="geography" class="inline-block h-5 font-semibold" data-active-links-target="link" data-action="click->tile#setTitle">Map</a>
            <a href="<%= locations_countries_path(search_params) %>" data-turbo-frame="geography" class="inline-block h-5 font-semibold" data-active-links-target="link" data-action="click->tile#setTitle">Countries</a>
            <a href="<%= locations_regions_path(search_params) %>" data-turbo-frame="geography" class="inline-block h-5 font-semibold"   data-active-links-target="link" data-action="click->tile#setTitle">Regions</a>
            <a href="<%= locations_cities_path(search_params) %>" data-turbo-frame="geography" class="inline-block h-5 font-semibold"   data-active-links-target="link" data-action="click->tile#setTitle">Cities</a>
          </div>
        </div>
      <% end %>
      <% component.with_statistic_display do %>
        <%= turbo_frame_tag :geography, src: locations_map_path(search_params), loading: :lazy %>
      <% end %>
      <% component.with_details_cta do %>
        <button data-action="click->details-modal#openModal" data-controller="details-modal" data-details-modal-target-value="#geography" class="link no-underline ">Details</button>
      <% end %>
    <% end %>

    <%= render AhoyCaptain::TileComponent.new(title: 'Devices') do |component| %>
      <% component.with_display_links do %>
        <div class="flex text-xs font-medium text-gray-400 space-x-2">
          <div class="relative inline-block text-left" data-controller="active-links">

            <a href="<%= devices_browsers_path(search_params) %>" data-turbo-frame="devices" class=" inline-block h-5 font-semibold"   data-active-links-target="link">Browser</a>
            <a href="<%= devices_operating_systems_path(search_params) %>" data-turbo-frame="devices" class="inline-block h-5 font-semibold"   data-active-links-target="link">OS</a>
            <a href="<%= devices_device_types_path(search_params) %>" data-turbo-frame="devices"  class="inline-block h-5 font-semibold"  data-active-links-target="link">Size</a>
          </div>
        </div>
      <% end %>
      <% component.with_statistic_display do %>
        <%= turbo_frame_tag :devices, src: devices_browsers_path(search_params), loading: :lazy %>
      <% end %>
      <% component.with_details_cta do %>
        <button data-action="click->details-modal#openModal" data-controller="details-modal" data-details-modal-target-value="#devices" class="link no-underline ">Details</button>
      <% end %>
    <% end %>
    <%= render AhoyCaptain::TileComponent.new(title: "Goals and Funnels", wide: true, classes: "p-4 m-2") do |component| %>
      <% component.with_display_links do %>
        <div>
          <div  data-controller="active-links">
            <div class="flex text-xs font-medium text-gray-400 space-x-2">
              <div class="relative inline-block text-left" data-controller="active-links">
                <a href="<%= goals_path(search_params) %>" data-turbo-frame="goals" class="inline-block h-5 font-semibold" data-active-links-target="link" data-action="click->tile#setTitle">Goals</a>
                <a href="<%= properties_path(search_params) %>" data-turbo-frame="goals" class="inline-block h-5 font-semibold" data-active-links-target="link" data-action="click->tile#setTitle">Properties</a>
                <%= render AhoyCaptain::DropdownLinkComponent.new(title: "Funnels") do |dropdown| %>
                  <% AhoyCaptain.config.funnels.each do |id, funnel| %>
                    <% dropdown.with_option do %>
                      <a href="<%= funnel_path(id, search_params) %>" data-turbo-frame="goals" class="link " data-action="click->tile#setTitle" title="<%= funnel.title %> Funnel">
                        <%= funnel.title %>
                      </a>
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      <% end %>
      <% component.with_statistic_display do %>
        <div class="p-4">
          <%= turbo_frame_tag :goals, src: goals_path(search_params), loading: :lazy %>
        </div>
      <% end %>
    <% end %>
  </div>
</main>

<%= render 'ahoy_captain/roots/filters' %>

<dialog id="detailsModal" class="modal">
  <div class="modal-box w-11/12 max-w-5xl">
    <%= turbo_frame_tag :details %>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
